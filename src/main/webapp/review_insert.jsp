<%@page import="dto.UploadDto"%>
<%@page import="dao.UploadDao"%>
<%@page import="util.IntegerUtil"%>
<%@page import="util.MultipartParser"%>
<%@page import="java.util.HashMap"%>
<%@page import="java.util.Map"%>
<%@page import="dto.ReviewDto"%>
<%@page import="dao.ReviewDao"%>
<%@ page language="java" contentType="application/json; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%	
	MultipartParser mp = new MultipartParser(request);

	int reviewStar = IntegerUtil.parseIntWithDefaultValue(mp.getFormDataValueByAttribute("name", "reviewStar"), 1);
	int productId = IntegerUtil.parseIntWithDefaultValue(mp.getFormDataValueByAttribute("name", "productId"), 1);
	String thumbnail = "data:image/jpeg;base64,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";
	String imageData = mp.getFormDataValueByAttribute("name", "image_data");
	String content = mp.getFormDataValueByAttribute("name", "content");
	String memberId=(String)session.getAttribute("memberId");

	if (imageData != null) {
		imageData = '"' + imageData + '"';
	}
	if (content != null) {
		content = '"' + content + '"';
	}
	UploadDto uploadDto = new UploadDto();
	uploadDto.setImageData(imageData);
	uploadDto.setUploaderId(memberId);
	
	boolean isImageInsert= UploadDao.getInstance().insert(uploadDto);
	
	ReviewDto reviewDto= new ReviewDto();
	reviewDto.setContent(content);
	reviewDto.setProductId(productId);
	reviewDto.setRating(reviewStar);
	reviewDto.setReviewerId(memberId);
	reviewDto.setThumbnail(thumbnail);
	boolean isInsertSuccess= ReviewDao.getInstance().insert(reviewDto);

	if (memberId != null) {
		memberId = '"' + memberId + '"';
	}
	if (thumbnail != null) {
		thumbnail = '"' + thumbnail + '"';
	}
%> 
{
	"memberId" : <%= memberId%>,
	"productId" : <%= productId%>,
	"thumbnail" : <%= thumbnail %>,
	"reviewStar": <%= reviewStar %>, 
	"imageData": <%= imageData %>, 
	"content": <%= content %>
}
